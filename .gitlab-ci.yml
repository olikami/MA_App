stages:
  - deploy

deploy_production:
  stage: deploy
  only:
    - main
  script:
    - cp -r backend ~/backend
    - cd ~/backend
    - python3 -m venv venv
    - source venv/bin/activate 
    - pip install --upgrade pip
    - pip install pip-tools
    - pip-sync
    - python manage.py migrate
    - python manage.py collectstatic --noinput 
  tags:
    - linux
    - prod
